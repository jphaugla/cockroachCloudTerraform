# tasks/add-githubs.yml
- name: Ensure base checkout dir exists
  become: yes
  ansible.builtin.file:
    path: "{{ crdb_file_location }}"
    state: directory
    owner: "{{ login_username }}"
    group: "{{ login_username }}"
    mode: '0755'

- name: Clone or update repos
  become: yes
  become_user: "{{ login_username }}"
  ansible.builtin.git:
    repo: "{{ item.repo }}"
    dest: "{{ crdb_file_location }}/{{ item.dest }}"
    version: "{{ item.version | default('main') }}"
    update: yes
    force: yes            # ðŸ‘ˆ reset --hard if dirty
    accept_hostkey: yes
  loop:
    - { repo: "https://github.com/jphaugla/Digital-Banking-CockroachDB", dest: "Digital-Banking-CockroachDB" }
    - { repo: "https://github.com/jphaugla/costCalculator.git",        dest: "costCalculator" }
    - { repo: "https://github.com/jphaugla/nextEcommerce.git",         dest: "nextEcommerce" }
    - { repo: "https://github.com/jphaugla/azureSQLtoCockroachDB.git", dest: "azureSQLtoCockroachDB" }
  register: git_result
  retries: 6
  delay: 10
  until: git_result is succeeded
